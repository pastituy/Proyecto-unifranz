generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id                     Int                @id @default(autoincrement())
  nombre                 String
  email                  String             @unique
  telefono               String
  pais                   String
  password               String
  creadoEn               DateTime           @default(now())
  ci                     String?
  rol                    Rol?
  usuarioCompana         UsuarioCompana[]
  ayudasRegistradas      Ayuda[]
  casosAceptados         Beneficiario[]     @relation("AceptadoPor")
  beneficiariosAsignados Beneficiario[]     @relation("AsignadoA")
  evaluacionesSociales   EvaluacionSocial[]
  notificaciones         Notificacion[]
  registrosCreados       PacienteRegistro[] @relation("CreadorRegistro")
  solicitudesRevisadas   SolicitudAyuda[]   @relation("RevisadoPor")
  solicitudesCreadas     SolicitudAyuda[]   @relation("SolicitadoPor")
}

model Donaciones {
  id            Int      @id @default(autoincrement())
  nombreDonante String
  cantidad      String
  metodoPago    String
  descripcion   String?
  idCampana     Int?
  campana       Campana? @relation(fields: [idCampana], references: [id])
  fecha         DateTime @default(now())
}

model Padre {
  id        Int        @id @default(autoincrement())
  nombre    String
  apellido  String
  telefono  String
  ci        String
  ubicacion String
  paciente  Paciente[]
}

model Paciente {
  id            Int           @id @default(autoincrement())
  nombre        String
  apellido      String
  ciudad        String
  tipoCancer    String
  edad          Int
  idPadre       Int
  fechaRegistro DateTime      @default(now())
  padre         Padre         @relation(fields: [idPadre], references: [id])
  Recuperados   Recuperados[]
  Tratamiento   Tratamiento[]
}

model Recuperados {
  id         Int      @id @default(autoincrement())
  idPaciente Int
  diagnosis  String
  image      String
  quote      String
  recovered  String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  paciente   Paciente @relation(fields: [idPaciente], references: [id])
}

model Tratamiento {
  id              Int       @id @default(autoincrement())
  tipoTratamiento String
  descripcion     String
  idPaciente      Int?
  estado          Boolean
  fecha           DateTime  @default(now())
  siguienteCita   DateTime
  paciente        Paciente? @relation(fields: [idPaciente], references: [id])
}

model Evento {
  id          Int    @id @default(autoincrement())
  titulo      String
  descripcion String
  fecha       String
  ubicacion   String
  img         String
}

model Campana {
  id             Int              @id @default(autoincrement())
  titulo         String
  descripcion    String
  fecha          String
  multimedia     String
  recaudado      Decimal?
  previstro      Decimal?
  donaciones     Donaciones[]
  usuarioCompana UsuarioCompana[]
}

model UsuarioCompana {
  id               Int      @id @default(autoincrement())
  idUsuario        Int?
  nombreUsuario    String?
  montoSuscripcion Int
  idCompana        Int
  fecha            DateTime @default(now())
  Campana          Campana  @relation(fields: [idCompana], references: [id])
  Usuario          Usuario? @relation(fields: [idUsuario], references: [id])
}

model PacienteRegistro {
  id                  Int               @id @default(autoincrement())
  nombreCompletoNino  String
  fechaNacimiento     DateTime
  edad                Int
  ciNino              String?
  diagnostico         String
  nombreCompletoTutor String
  ciTutor             String
  parentesco          String
  telefonoTutor       String
  direccion           String
  emailTutor          String?
  estado              EstadoRegistro    @default(REGISTRO_INICIAL)
  motivoRechazo       String?
  creadoPorId         Int
  creadoPor           Usuario           @relation("CreadorRegistro", fields: [creadoPorId], references: [id])
  fechaRegistro       DateTime          @default(now())
  updatedAt           DateTime          @updatedAt

  evaluacionSocial    EvaluacionSocial?
  beneficiario        Beneficiario?

  @@map("pacientes_registro")
}

model EvaluacionSocial {
  id                     Int                 @id @default(autoincrement())
  pacienteRegistroId     Int                 @unique
  ingresoFamiliar        Int
  numPersonasHogar       Int
  tipoVivienda           Int
  situacionLaboralPadres Int
  accesoSalud            Int
  gastosMedicosMensuales Int
  puntajeTotal           Int
  nivelVulnerabilidad    NivelVulnerabilidad
  informeSocialPdf       String?
  trabajadorSocialId     Int
  fechaEvaluacion        DateTime            @default(now())
  updatedAt              DateTime            @updatedAt
  observaciones          String?
  pacienteRegistro       PacienteRegistro    @relation(fields: [pacienteRegistroId], references: [id], onDelete: Cascade)
  trabajadorSocial       Usuario             @relation(fields: [trabajadorSocialId], references: [id])

  @@map("evaluaciones_sociales")
}

model Beneficiario {
  id                          Int                   @id @default(autoincrement())
  pacienteRegistroId          Int                   @unique
  codigoBeneficiario          String                @unique
  estadoBeneficiario          EstadoBeneficiario    @default(ACTIVO)
  estadoMedico                EstadoMedico          @default(EN_TRATAMIENTO)
  fechaAceptacion             DateTime              @default(now())
  aceptadoPorId               Int
  asignadoAId                 Int?
  historiaClinica             String?               @unique
  fechaPrimerContacto         DateTime?
  nombreMedicoTratante        String?
  especialidadMedico          String?
  telefonoMedico              String?
  institucionMedica           String?
  faseTratamiento             FaseTratamiento?
  semanaProtocolo             Int?
  esquemaTratamiento          String?
  ultimaFechaControl          DateTime?
  proximaFechaControl         DateTime?
  frecuenciaControl           String?
  fechaInicioVigilancia       DateTime?
  tiempoVigilanciaAnios       Int?
  fechaUltimaAsistencia       DateTime?
  motivoAbandono              String?
  notificadoDefensoria        Boolean               @default(false)
  fechaNotificacionDefensoria DateTime?
  fechaFallecimiento          DateTime?
  causaFallecimiento          String?
  alergiasMedicamentos        String?
  complicaciones              String?
  observacionesMedicas        String?
  updatedAt                   DateTime              @updatedAt
  ayudas                      Ayuda[]
  aceptadoPor                 Usuario               @relation("AceptadoPor", fields: [aceptadoPorId], references: [id])
  asignadoA                   Usuario?              @relation("AsignadoA", fields: [asignadoAId], references: [id])
  pacienteRegistro            PacienteRegistro      @relation(fields: [pacienteRegistroId], references: [id], onDelete: Cascade)
  sesionesQuimioterapia       SesionQuimioterapia[]
  solicitudesAyuda            SolicitudAyuda[]

  @@map("beneficiarios")
}

model Ayuda {
  id               Int          @id @default(autoincrement())
  beneficiarioId   Int
  fechaAyuda       DateTime     @default(now())
  medicamentos     Decimal      @default(0)
  analisisExamenes Decimal      @default(0)
  quimioterapia    Decimal      @default(0)
  transporte       Decimal      @default(0)
  alimentacion     Decimal      @default(0)
  otros            Decimal      @default(0)
  totalAyuda       Decimal
  observaciones    String?
  registradoPorId  Int
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt
  beneficiario     Beneficiario @relation(fields: [beneficiarioId], references: [id], onDelete: Cascade)
  registradoPor    Usuario      @relation(fields: [registradoPorId], references: [id])

  @@map("ayudas")
}

model SesionQuimioterapia {
  id              Int                @id @default(autoincrement())
  beneficiarioId  Int
  numeroSesion    Int
  fechaProgramada DateTime
  fechaRealizada  DateTime?
  estado          EstadoSesionQuimio @default(PROGRAMADA)
  observaciones   String?
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  beneficiario    Beneficiario       @relation(fields: [beneficiarioId], references: [id], onDelete: Cascade)

  @@map("sesiones_quimioterapia")
}

model SolicitudAyuda {
  id                   Int                @id @default(autoincrement())
  codigoSolicitud      String             @unique
  beneficiarioId       Int
  solicitadoPorId      Int
  fechaSolicitud       DateTime           @default(now())
  prioridad            PrioridadSolicitud @default(MEDIA)
  tipoAyuda            TipoAyuda
  numeroReceta         String?
  fechaReceta          DateTime?
  medicoPrescriptor    String?
  recetaPdf            String?
  detalleSolicitud     String
  costoEstimado        Decimal?
  observaciones        String?
  estado               EstadoSolicitud    @default(PENDIENTE)
  revisadoPorId        Int?
  fechaRevision        DateTime?
  motivoRechazo        String?
  fechaEntrega         DateTime?
  lugarEntrega         String?
  costoReal            Decimal?
  proveedor            String?
  facturaPdf           String?
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt
  instruccionesEntrega String?
  montoAprobado        Decimal?
  beneficiario         Beneficiario       @relation(fields: [beneficiarioId], references: [id], onDelete: Cascade)
  revisadoPor          Usuario?           @relation("RevisadoPor", fields: [revisadoPorId], references: [id])
  solicitadoPor        Usuario            @relation("SolicitadoPor", fields: [solicitadoPorId], references: [id])

  @@map("solicitudes_ayuda")
}

model Notificacion {
  id                Int       @id @default(autoincrement())
  usuarioId         Int
  emailDestinatario String?
  tipo              String
  prioridad         String    @default("normal")
  titulo            String
  mensaje           String
  relacionadoTipo   String?
  relacionadoId     Int?
  leida             Boolean   @default(false)
  fechaLeida        DateTime?
  emailEnviado      Boolean   @default(false)
  fechaEmailEnviado DateTime?
  createdAt         DateTime  @default(now())
  usuario           Usuario   @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@map("notificaciones")
}

model CodigoVerificacion {
  id        Int      @id @default(autoincrement())
  email     String
  codigo    String
  usado     Boolean  @default(false)
  expiraEn  DateTime
  createdAt DateTime @default(now())

  @@index([email, codigo])
  @@map("codigos_verificacion")
}

model WhatsappTemplate {
  id          Int      @id @default(autoincrement())
  codigo      String   @unique
  plantilla   String   @db.Text
  descripcion String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("whatsapp_templates")
}

enum Rol {
  ADMINISTRADOR
  PSICOLOGO
  TRABAJADOR_SOCIAL
  ASISTENTE
  BENEFICIARIO
}

enum EstadoRegistro {
  REGISTRO_INICIAL
  EN_EVALUACION_ADMINISTRADOR
  BENEFICIARIO_ACTIVO
  CASO_RECHAZADO
}

enum EstadoBeneficiario {
  ACTIVO
  INACTIVO
  RECUPERADO
  FALLECIDO
}

enum NivelVulnerabilidad {
  BAJO
  MEDIO
  ALTO
}

enum EstadoSesionQuimio {
  PROGRAMADA
  REALIZADA
  REPROGRAMADA
  NO_ASISTIO
}

enum EstadoMedico {
  EN_TRATAMIENTO
  VIGILANCIA
  PALIATIVO
  ABANDONO
  FALLECIDO
}

enum FaseTratamiento {
  INDUCCION
  CONSOLIDACION
  INTENSIFICACION
  MANTENIMIENTO
  POST_TRATAMIENTO
}

enum TipoAyuda {
  MEDICAMENTOS
  QUIMIOTERAPIA
  ANALISIS_EXAMENES
  OTRO
}

enum PrioridadSolicitud {
  BAJA
  MEDIA
  ALTA
  URGENTE
}

enum EstadoSolicitud {
  PENDIENTE
  RECEPCIONADO
  ENTREGADO
  RECHAZADO
}
